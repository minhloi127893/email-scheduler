<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}" th:with="activePage='schedules'">

<head>
	<title th:text="${schedule.id} != null ? 'Edit Schedule' : 'New Schedule'">Schedule Form</title>
</head>

<body>
	<section layout:fragment="content">
		<h2 th:text="${schedule.id} != null ? 'Edit Schedule' : 'New Email Schedule'"></h2>
		<!-- Form action tùy theo create hay edit -->
		<form th:action="${schedule.id} != null ? @{/schedules/update/{id}(id=${schedule.id})} : @{/schedules}"
			th:object="${schedule}" method="post">

			<div class="mb-3">
				<label>Recipients</label>
				<input type="text" th:field="*{recipients}" class="form-control" />
			</div>

			<div class="mb-3">
				<label>Type</label>
				<select th:field="*{type}" class="form-control" id="scheduleType" onchange="toggleCronField()">
					<option th:each="typeOpt : ${T(com.javatest.email_scheduler.common.enums.FrequencyType).values()}"
						th:value="${typeOpt}" th:text="${typeOpt}"></option>
				</select>
			</div>

			<div class="mb-3" id="cronField" style="display:none;">
				<label>Cron Expression</label>
				<input type="text" th:field="*{cronExpression}" class="form-control" placeholder="e.g. 0 0 8 * * ?" />
			</div>

			<div class="mb-3">
				<label>Time Config</label>
				<input type="text" th:field="*{timeConfig}" class="form-control" placeholder="09:00 or MONDAY 09:00" />
			</div>

			<div class="mb-3">
				<label>Template</label>
				<select th:field="*{templateId}" class="form-control">
					<option th:each="t : ${templates}" th:value="${t.id}" th:text="${t.subject}"></option>
				</select>
			</div>

			<button type="submit" class="btn btn-success"
				th:text="${schedule.id} != null ? 'Update' : 'Save'">Save</button>
			<!-- nút Back -->
			<a href="/schedules" class="btn btn-secondary ms-2">Back</a>
		</form>

		<script>	
			function toggleCronField() {
				const type = document.getElementById("scheduleType").value;
				const cronDiv = document.getElementById("cronField");
				cronDiv.style.display = (type === "CRON") ? "block" : "none";
			}
			document.addEventListener("DOMContentLoaded", toggleCronField);
		</script>
</body>

</html>